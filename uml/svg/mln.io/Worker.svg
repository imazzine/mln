<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="788px" preserveAspectRatio="none" style="width:1471px;height:788px;background:#FFFFFF;" version="1.1" viewBox="0 0 1471 788" width="1471px" zoomAndPan="magnify"><defs/><g><g id="elem_process.env"><rect fill="#F1F1F1" height="239.5625" style="stroke:#181818;stroke-width:0.5;" width="484" x="523.5" y="7"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="723" y="21.9951">process.env</text><line style="stroke:#181818;stroke-width:0.5;" x1="524.5" x2="1006.5" y1="27.2969" y2="27.2969"/><ellipse cx="534.5" cy="40.9453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="358" x="543.5" y="44.292">MLN_KAFKA_HOSTS: localhost:9092,127.0.0.1:9092</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="524.5" x2="1006.5" y1="51.5938" y2="51.5938"/><ellipse cx="534.5" cy="65.2422" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="380" x="543.5" y="68.5889">MLN_KAFKA_CONNECTION_TIMEOUT: default 10000 ms</text><ellipse cx="534.5" cy="81.5391" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="356" x="543.5" y="84.8857">MLN_KAFKA_CONNECTION_IDLE: default 300000 ms</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="524.5" x2="1006.5" y1="92.1875" y2="92.1875"/><ellipse cx="534.5" cy="105.8359" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="354" x="543.5" y="109.1826">MLN_KAFKA_REQUEST_TIMEOUT: default 30000 ms</text><ellipse cx="534.5" cy="122.1328" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="323" x="543.5" y="125.4795">MLN_KAFKA_REQUEST_MAX_ASYNC: default 10</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="524.5" x2="1006.5" y1="132.7813" y2="132.7813"/><ellipse cx="534.5" cy="146.4297" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="399" x="543.5" y="149.7764">MLN_KAFKA_PRODUCER_HIGH_WATER_MARK: default 100</text><ellipse cx="534.5" cy="162.7266" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="384" x="543.5" y="166.0732">MLN_KAFKA_PRODUCER_ACK_TIMEOUT: default 100 ms</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="524.5" x2="1006.5" y1="173.375" y2="173.375"/><ellipse cx="534.5" cy="187.0234" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="400" x="543.5" y="190.3701">MLN_KAFKA_CONSUMER_HIGH_WATER_MARK: default 100</text><ellipse cx="534.5" cy="203.3203" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="411" x="543.5" y="206.667">MLN_KAFKA_CONSUMER_FETCH_MAX_WAIT: default 100 ms</text><ellipse cx="534.5" cy="219.6172" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="375" x="543.5" y="222.9639">MLN_KAFKA_CONSUMER_FETCH_MIN_BYTES: default 1</text><ellipse cx="534.5" cy="235.9141" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="458" x="543.5" y="239.2607">MLN_KAFKA_CONSUMER_FETCH_MAX_BYTES: default 1024 * 1024</text></g><!--MD5=[7b5bd88a8a025decccf0c9eac4aaabe9]
class Worker--><g id="elem_Worker"><rect codeLine="20" fill="#F1F1F1" height="300.1563" id="Worker" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="427" x="552" y="324"/><ellipse cx="736.75" cy="340" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M739.7188,345.6406 Q739.1406,345.9375 738.5,346.0781 Q737.8594,346.2344 737.1563,346.2344 Q734.6563,346.2344 733.3281,344.5938 Q732.0156,342.9375 732.0156,339.8125 Q732.0156,336.6875 733.3281,335.0313 Q734.6563,333.375 737.1563,333.375 Q737.8594,333.375 738.5,333.5313 Q739.1563,333.6875 739.7188,333.9844 L739.7188,336.7031 Q739.0938,336.125 738.5,335.8594 Q737.9063,335.5781 737.2813,335.5781 Q735.9375,335.5781 735.25,336.6563 Q734.5625,337.7188 734.5625,339.8125 Q734.5625,341.9063 735.25,342.9844 Q735.9375,344.0469 737.2813,344.0469 Q737.9063,344.0469 738.5,343.7813 Q739.0938,343.5 739.7188,342.9219 L739.7188,345.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="757.25" y="344.8467">Worker</text><line style="stroke:#181818;stroke-width:0.5;" x1="553" x2="978" y1="356" y2="356"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="560" y="366.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169" x="572" y="372.9951">_client: kafka.KafkaClient</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="560" y="382.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="231" x="572" y="389.292">_producer: kafka.ProducerStream</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="560" y="399.2422"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="247" x="572" y="405.5889">_consumer: kafka.ConsumerStream</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="560" y="415.5391"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="274" x="572" y="421.8857">_resources: Map&lt;resource, workers[]&gt;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="560" y="431.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="259" x="572" y="438.1826">_workers: Map&lt;worker, resources[]&gt;</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="560" y="448.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="401" x="572" y="454.4795">_connections: Map&lt;worker, [out: Readable, in: Writable]&gt;</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="553" x2="978" y1="461.7813" y2="461.7813"/><polygon fill="#FFFF44" points="563,470.4297,567,474.4297,563,478.4297,559,474.4297" style="stroke:#B38D22;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="238" x="572" y="478.7764">getRate(resource: string): number</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="553" x2="978" y1="486.0781" y2="486.0781"/><ellipse cx="563" cy="499.7266" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="572" y="503.0732">ping(): void</text><ellipse cx="563" cy="516.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="191" x="572" y="519.3701">sync([worker, worker]): void</text><ellipse cx="563" cy="532.3203" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="184" x="572" y="535.667">rate(resource: string): void</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="553" x2="978" y1="542.9688" y2="542.9688"/><ellipse cx="563" cy="556.6172" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210" x="572" y="559.9639">register(resource: string): void</text><ellipse cx="563" cy="572.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="228" x="572" y="576.2607">unregister(resource: string): void</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:1.0,2.0;" x1="553" x2="978" y1="583.5625" y2="583.5625"/><ellipse cx="563" cy="597.2109" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="199" x="572" y="600.5576">connect(worker: string): void</text><ellipse cx="563" cy="613.5078" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="219" x="572" y="616.8545">disconnect(worker: string): void</text></g><!--MD5=[40606f813c97ea4223906e5f64aa9ea5]
class Ready--><g id="elem_Ready"><rect codeLine="42" fill="#F1F1F1" height="64.2969" id="Ready" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="115" y="442"/><ellipse cx="147.1" cy="458" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M150.0688,463.6406 Q149.4906,463.9375 148.85,464.0781 Q148.2094,464.2344 147.5063,464.2344 Q145.0063,464.2344 143.6781,462.5938 Q142.3656,460.9375 142.3656,457.8125 Q142.3656,454.6875 143.6781,453.0313 Q145.0063,451.375 147.5063,451.375 Q148.2094,451.375 148.85,451.5313 Q149.5063,451.6875 150.0688,451.9844 L150.0688,454.7031 Q149.4438,454.125 148.85,453.8594 Q148.2563,453.5781 147.6313,453.5781 Q146.2875,453.5781 145.6,454.6563 Q144.9125,455.7188 144.9125,457.8125 Q144.9125,459.9063 145.6,460.9844 Q146.2875,462.0469 147.6313,462.0469 Q148.2563,462.0469 148.85,461.7813 Q149.4438,461.5 150.0688,460.9219 L150.0688,463.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="164.9" y="462.8467">Ready</text><line style="stroke:#181818;stroke-width:0.5;" x1="116" x2="227" y1="474" y2="474"/><ellipse cx="126" cy="487.6484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="135" y="490.9951">type: "ready"</text><line style="stroke:#181818;stroke-width:0.5;" x1="116" x2="227" y1="498.2969" y2="498.2969"/></g><!--MD5=[06e88d5755d5065f19f5ec155a1c86a5]
class Sync--><g id="elem_Sync"><rect codeLine="47" fill="#F1F1F1" height="80.5938" id="Sync" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="133" x="263" y="433.5"/><ellipse cx="308.75" cy="449.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M311.7188,455.1406 Q311.1406,455.4375 310.5,455.5781 Q309.8594,455.7344 309.1563,455.7344 Q306.6563,455.7344 305.3281,454.0938 Q304.0156,452.4375 304.0156,449.3125 Q304.0156,446.1875 305.3281,444.5313 Q306.6563,442.875 309.1563,442.875 Q309.8594,442.875 310.5,443.0313 Q311.1563,443.1875 311.7188,443.4844 L311.7188,446.2031 Q311.0938,445.625 310.5,445.3594 Q309.9063,445.0781 309.2813,445.0781 Q307.9375,445.0781 307.25,446.1563 Q306.5625,447.2188 306.5625,449.3125 Q306.5625,451.4063 307.25,452.4844 Q307.9375,453.5469 309.2813,453.5469 Q309.9063,453.5469 310.5,453.2813 Q311.0938,453 311.7188,452.4219 L311.7188,455.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="329.25" y="454.3467">Sync</text><line style="stroke:#181818;stroke-width:0.5;" x1="264" x2="395" y1="465.5" y2="465.5"/><ellipse cx="274" cy="479.1484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="283" y="482.4951">type: "sync"</text><ellipse cx="274" cy="495.4453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="283" y="498.792">scope: workers</text><line style="stroke:#181818;stroke-width:0.5;" x1="264" x2="395" y1="506.0938" y2="506.0938"/></g><!--MD5=[59e25865eff7d5dcb20dd0fd75436df0]
class Updated--><g id="elem_Updated"><rect codeLine="53" fill="#F1F1F1" height="80.5938" id="Updated" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="213" x="7" y="701"/><ellipse cx="79.75" cy="717" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M82.7188,722.6406 Q82.1406,722.9375 81.5,723.0781 Q80.8594,723.2344 80.1563,723.2344 Q77.6563,723.2344 76.3281,721.5938 Q75.0156,719.9375 75.0156,716.8125 Q75.0156,713.6875 76.3281,712.0313 Q77.6563,710.375 80.1563,710.375 Q80.8594,710.375 81.5,710.5313 Q82.1563,710.6875 82.7188,710.9844 L82.7188,713.7031 Q82.0938,713.125 81.5,712.8594 Q80.9063,712.5781 80.2813,712.5781 Q78.9375,712.5781 78.25,713.6563 Q77.5625,714.7188 77.5625,716.8125 Q77.5625,718.9063 78.25,719.9844 Q78.9375,721.0469 80.2813,721.0469 Q80.9063,721.0469 81.5,720.7813 Q82.0938,720.5 82.7188,719.9219 L82.7188,722.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="100.25" y="721.8467">Updated</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="219" y1="733" y2="733"/><ellipse cx="18" cy="746.6484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="27" y="749.9951">type: "updated"</text><ellipse cx="18" cy="762.9453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="187" x="27" y="766.292">scope: [worker, resources]</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="219" y1="773.5938" y2="773.5938"/></g><!--MD5=[3d514cc18661aa80a501d3353505fde1]
class Removed--><g id="elem_Removed"><rect codeLine="59" fill="#F1F1F1" height="80.5938" id="Removed" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="213" x="255" y="701"/><ellipse cx="324.25" cy="717" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M327.2188,722.6406 Q326.6406,722.9375 326,723.0781 Q325.3594,723.2344 324.6563,723.2344 Q322.1563,723.2344 320.8281,721.5938 Q319.5156,719.9375 319.5156,716.8125 Q319.5156,713.6875 320.8281,712.0313 Q322.1563,710.375 324.6563,710.375 Q325.3594,710.375 326,710.5313 Q326.6563,710.6875 327.2188,710.9844 L327.2188,713.7031 Q326.5938,713.125 326,712.8594 Q325.4063,712.5781 324.7813,712.5781 Q323.4375,712.5781 322.75,713.6563 Q322.0625,714.7188 322.0625,716.8125 Q322.0625,718.9063 322.75,719.9844 Q323.4375,721.0469 324.7813,721.0469 Q325.4063,721.0469 326,720.7813 Q326.5938,720.5 327.2188,719.9219 L327.2188,722.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="344.75" y="721.8467">Removed</text><line style="stroke:#181818;stroke-width:0.5;" x1="256" x2="467" y1="733" y2="733"/><ellipse cx="266" cy="746.6484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="275" y="749.9951">type: "removed"</text><ellipse cx="266" cy="762.9453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="187" x="275" y="766.292">scope: [worker, resources]</text><line style="stroke:#181818;stroke-width:0.5;" x1="256" x2="467" y1="773.5938" y2="773.5938"/></g><!--MD5=[0b83492021a2ada4b97aa2318f99f432]
class Rate--><g id="elem_Rate"><rect codeLine="65" fill="#F1F1F1" height="80.5938" id="Rate" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="275" x="503" y="701"/><ellipse cx="620.25" cy="717" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M623.2188,722.6406 Q622.6406,722.9375 622,723.0781 Q621.3594,723.2344 620.6563,723.2344 Q618.1563,723.2344 616.8281,721.5938 Q615.5156,719.9375 615.5156,716.8125 Q615.5156,713.6875 616.8281,712.0313 Q618.1563,710.375 620.6563,710.375 Q621.3594,710.375 622,710.5313 Q622.6563,710.6875 623.2188,710.9844 L623.2188,713.7031 Q622.5938,713.125 622,712.8594 Q621.4063,712.5781 620.7813,712.5781 Q619.4375,712.5781 618.75,713.6563 Q618.0625,714.7188 618.0625,716.8125 Q618.0625,718.9063 618.75,719.9844 Q619.4375,721.0469 620.7813,721.0469 Q621.4063,721.0469 622,720.7813 Q622.5938,720.5 623.2188,719.9219 L623.2188,722.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="640.75" y="721.8467">Rate</text><line style="stroke:#181818;stroke-width:0.5;" x1="504" x2="777" y1="733" y2="733"/><ellipse cx="514" cy="746.6484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="523" y="749.9951">type: "rate"</text><ellipse cx="514" cy="762.9453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="249" x="523" y="766.292">scope: [ worker, resource, number ]</text><line style="stroke:#181818;stroke-width:0.5;" x1="504" x2="777" y1="773.5938" y2="773.5938"/></g><!--MD5=[d36b8f9ecd153c8d204dc126f927fd9e]
class Connecting--><g id="elem_Connecting"><rect codeLine="71" fill="#F1F1F1" height="80.5938" id="Connecting" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153" x="813" y="701"/><ellipse cx="846.45" cy="717" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M849.4188,722.6406 Q848.8406,722.9375 848.2,723.0781 Q847.5594,723.2344 846.8563,723.2344 Q844.3563,723.2344 843.0281,721.5938 Q841.7156,719.9375 841.7156,716.8125 Q841.7156,713.6875 843.0281,712.0313 Q844.3563,710.375 846.8563,710.375 Q847.5594,710.375 848.2,710.5313 Q848.8563,710.6875 849.4188,710.9844 L849.4188,713.7031 Q848.7938,713.125 848.2,712.8594 Q847.6063,712.5781 846.9813,712.5781 Q845.6375,712.5781 844.95,713.6563 Q844.2625,714.7188 844.2625,716.8125 Q844.2625,718.9063 844.95,719.9844 Q845.6375,721.0469 846.9813,721.0469 Q847.6063,721.0469 848.2,720.7813 Q848.7938,720.5 849.4188,719.9219 L849.4188,722.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="864.55" y="721.8467">Connecting</text><line style="stroke:#181818;stroke-width:0.5;" x1="814" x2="965" y1="733" y2="733"/><ellipse cx="824" cy="746.6484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="833" y="749.9951">type: "connecting"</text><ellipse cx="824" cy="762.9453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="833" y="766.292">scope: worker</text><line style="stroke:#181818;stroke-width:0.5;" x1="814" x2="965" y1="773.5938" y2="773.5938"/></g><!--MD5=[d71ee11ede0e83c966e8ef97d9465fe6]
class Stream--><g id="elem_Stream"><rect codeLine="77" fill="#F1F1F1" height="80.5938" id="Stream" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="1001.5" y="701"/><ellipse cx="1067.75" cy="717" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1070.7188,722.6406 Q1070.1406,722.9375 1069.5,723.0781 Q1068.8594,723.2344 1068.1563,723.2344 Q1065.6563,723.2344 1064.3281,721.5938 Q1063.0156,719.9375 1063.0156,716.8125 Q1063.0156,713.6875 1064.3281,712.0313 Q1065.6563,710.375 1068.1563,710.375 Q1068.8594,710.375 1069.5,710.5313 Q1070.1563,710.6875 1070.7188,710.9844 L1070.7188,713.7031 Q1070.0938,713.125 1069.5,712.8594 Q1068.9063,712.5781 1068.2813,712.5781 Q1066.9375,712.5781 1066.25,713.6563 Q1065.5625,714.7188 1065.5625,716.8125 Q1065.5625,718.9063 1066.25,719.9844 Q1066.9375,721.0469 1068.2813,721.0469 Q1068.9063,721.0469 1069.5,720.7813 Q1070.0938,720.5 1070.7188,719.9219 L1070.7188,722.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="1088.25" y="721.8467">Stream</text><line style="stroke:#181818;stroke-width:0.5;" x1="1002.5" x2="1190.5" y1="733" y2="733"/><ellipse cx="1012.5" cy="746.6484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="1021.5" y="749.9951">type: "stream"</text><ellipse cx="1012.5" cy="762.9453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="1021.5" y="766.292">scope: [worker, worker]</text><line style="stroke:#181818;stroke-width:0.5;" x1="1002.5" x2="1190.5" y1="773.5938" y2="773.5938"/></g><!--MD5=[eb76a53c7179f7af2118c0484ff690a3]
class Connected--><g id="elem_Connected"><rect codeLine="83" fill="#F1F1F1" height="80.5938" id="Connected" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196" x="1226.5" y="701"/><ellipse cx="1281.75" cy="717" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1284.7188,722.6406 Q1284.1406,722.9375 1283.5,723.0781 Q1282.8594,723.2344 1282.1563,723.2344 Q1279.6563,723.2344 1278.3281,721.5938 Q1277.0156,719.9375 1277.0156,716.8125 Q1277.0156,713.6875 1278.3281,712.0313 Q1279.6563,710.375 1282.1563,710.375 Q1282.8594,710.375 1283.5,710.5313 Q1284.1563,710.6875 1284.7188,710.9844 L1284.7188,713.7031 Q1284.0938,713.125 1283.5,712.8594 Q1282.9063,712.5781 1282.2813,712.5781 Q1280.9375,712.5781 1280.25,713.6563 Q1279.5625,714.7188 1279.5625,716.8125 Q1279.5625,718.9063 1280.25,719.9844 Q1280.9375,721.0469 1282.2813,721.0469 Q1282.9063,721.0469 1283.5,720.7813 Q1284.0938,720.5 1284.7188,719.9219 L1284.7188,722.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77" x="1302.25" y="721.8467">Connected</text><line style="stroke:#181818;stroke-width:0.5;" x1="1227.5" x2="1421.5" y1="733" y2="733"/><ellipse cx="1237.5" cy="746.6484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124" x="1246.5" y="749.9951">type: "connected"</text><ellipse cx="1237.5" cy="762.9453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="1246.5" y="766.292">scope: [worker, [out, in]]</text><line style="stroke:#181818;stroke-width:0.5;" x1="1227.5" x2="1421.5" y1="773.5938" y2="773.5938"/></g><!--MD5=[781ebdc40aaf19b0258083daab4e8acf]
class Disonnected--><g id="elem_Disonnected"><rect codeLine="89" fill="#F1F1F1" height="80.5938" id="Disonnected" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="170" x="1294.5" y="433.5"/><ellipse cx="1331.55" cy="449.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1334.5188,455.1406 Q1333.9406,455.4375 1333.3,455.5781 Q1332.6594,455.7344 1331.9563,455.7344 Q1329.4563,455.7344 1328.1281,454.0938 Q1326.8156,452.4375 1326.8156,449.3125 Q1326.8156,446.1875 1328.1281,444.5313 Q1329.4563,442.875 1331.9563,442.875 Q1332.6594,442.875 1333.3,443.0313 Q1333.9563,443.1875 1334.5188,443.4844 L1334.5188,446.2031 Q1333.8938,445.625 1333.3,445.3594 Q1332.7063,445.0781 1332.0813,445.0781 Q1330.7375,445.0781 1330.05,446.1563 Q1329.3625,447.2188 1329.3625,449.3125 Q1329.3625,451.4063 1330.05,452.4844 Q1330.7375,453.5469 1332.0813,453.5469 Q1332.7063,453.5469 1333.3,453.2813 Q1333.8938,453 1334.5188,452.4219 L1334.5188,455.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="1350.45" y="454.3467">Disonnected</text><line style="stroke:#181818;stroke-width:0.5;" x1="1295.5" x2="1463.5" y1="465.5" y2="465.5"/><ellipse cx="1305.5" cy="479.1484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144" x="1314.5" y="482.4951">type: "disconnected"</text><ellipse cx="1305.5" cy="495.4453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="1314.5" y="498.792">scope: worker</text><line style="stroke:#181818;stroke-width:0.5;" x1="1295.5" x2="1463.5" y1="506.0938" y2="506.0938"/></g><!--MD5=[e9ce63d7eae5b5ad2d9171546e62195a]
class Unstream--><g id="elem_Unstream"><rect codeLine="95" fill="#F1F1F1" height="80.5938" id="Unstream" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="190" x="1069.5" y="433.5"/><ellipse cx="1126.75" cy="449.5" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1129.7188,455.1406 Q1129.1406,455.4375 1128.5,455.5781 Q1127.8594,455.7344 1127.1563,455.7344 Q1124.6563,455.7344 1123.3281,454.0938 Q1122.0156,452.4375 1122.0156,449.3125 Q1122.0156,446.1875 1123.3281,444.5313 Q1124.6563,442.875 1127.1563,442.875 Q1127.8594,442.875 1128.5,443.0313 Q1129.1563,443.1875 1129.7188,443.4844 L1129.7188,446.2031 Q1129.0938,445.625 1128.5,445.3594 Q1127.9063,445.0781 1127.2813,445.0781 Q1125.9375,445.0781 1125.25,446.1563 Q1124.5625,447.2188 1124.5625,449.3125 Q1124.5625,451.4063 1125.25,452.4844 Q1125.9375,453.5469 1127.2813,453.5469 Q1127.9063,453.5469 1128.5,453.2813 Q1129.0938,453 1129.7188,452.4219 L1129.7188,455.1406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="1147.25" y="454.3467">Unstream</text><line style="stroke:#181818;stroke-width:0.5;" x1="1070.5" x2="1258.5" y1="465.5" y2="465.5"/><ellipse cx="1080.5" cy="479.1484" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="1089.5" y="482.4951">type: "unstream"</text><ellipse cx="1080.5" cy="495.4453" fill="none" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="1089.5" y="498.792">scope: [worker, worker]</text><line style="stroke:#181818;stroke-width:0.5;" x1="1070.5" x2="1258.5" y1="506.0938" y2="506.0938"/></g><!--MD5=[2094b46fdbbe4b58ecb3a1ea43d82c2a]
link process.env to Worker--><g id="link_process.env_Worker"><path codeLine="40" d="M765.5,247.21 C765.5,270.31 765.5,294.81 765.5,318.84 " fill="none" id="process.env-to-Worker" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="765.5,323.96,769.5,314.96,765.5,318.96,761.5,314.96,765.5,323.96" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="766.5" y="290.0669">use to connect to the kafka</text></g><!--MD5=[a2d0a0cf25b0ec1623c80ac72151ddd5]
reverse link Ready to Worker--><g id="link_Ready_Worker"><path codeLine="45" d="M179.33,436.83 C188.77,401.83 208.24,350.87 245.5,324 C307.77,279.09 342.62,291.05 417.5,308 C462.55,318.19 508.59,334.95 551.83,354 " fill="none" id="Ready-backto-Worker" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="178.01,441.87,184.1643,434.1807,179.2797,437.0339,176.4265,432.1493,178.01,441.87" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="362.5" y="290.0669">dispatch</text></g><!--MD5=[be9d5a1ae6a2cc21163de4138bb9931e]
reverse link Sync to Worker--><g id="link_Sync_Worker"><path codeLine="51" d="M401.19,474 C442.75,474 497.47,474 551.83,474 " fill="none" id="Sync-backto-Worker" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="396.19,474,405.19,478,401.19,474,405.19,470,396.19,474" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="414.5" y="452.0669">.ping() -&gt; dispatch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="435" y="467.1997">with workers</text></g><!--MD5=[201392504166c92437c1acae7efd31c2]
link Worker to Updated--><g id="link_Worker_Updated"><path codeLine="57" d="M551.86,566.64 C506.3,585.85 458.39,605.79 413.5,624 C350.43,649.59 279.45,677.21 222.37,699.13 " fill="none" id="Worker-to-Updated" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="217.59,700.96,227.4255,701.4727,222.2586,699.1699,224.5614,694.003,217.59,700.96" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="332.5" y="667.0669">dispatch</text></g><!--MD5=[18be8ebdcbb3f54a6f804836a0fb28cf]
link Worker to Removed--><g id="link_Worker_Removed"><path codeLine="63" d="M551.97,615.33 C505.9,645.6 460.64,675.35 425.8,698.24 " fill="none" id="Worker-to-Removed" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="421.61,701,431.3263,699.3896,425.7855,698.2496,426.9256,692.7088,421.61,701" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="493.5" y="667.0669">dispatch</text></g><!--MD5=[65d996954ed4eca789ff063f3703fec2]
link Worker to Rate--><g id="link_Worker_Rate"><path codeLine="69" d="M695.33,624.05 C682.91,650.42 670.9,675.92 661.31,696.31 " fill="none" id="Worker-to-Rate" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="659.17,700.84,666.6264,694.4055,661.3024,696.3175,659.3904,690.9936,659.17,700.84" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="682.5" y="667.0669">dispatch</text></g><!--MD5=[1eab03e59d2bd61fbf01a3f19fe4a41c]
link Worker to Connecting--><g id="link_Worker_Connecting"><path codeLine="75" d="M835.11,624.05 C847.43,650.42 859.34,675.92 868.86,696.31 " fill="none" id="Worker-to-Connecting" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="870.98,700.84,870.7971,690.9928,868.8648,696.3094,863.5482,694.3772,870.98,700.84" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="856.5" y="667.0669">dispatch</text></g><!--MD5=[4a197213261024a32191598051f0ff96]
link Worker to Stream--><g id="link_Worker_Stream"><path codeLine="81" d="M951.32,624.05 C984.89,650.98 1017.33,677 1043,697.58 " fill="none" id="Worker-to-Stream" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1047.06,700.84,1042.5427,692.0882,1043.1598,697.7113,1037.5368,698.3285,1047.06,700.84" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="1008.5" y="667.0669">dispatch</text></g><!--MD5=[fc92f8eab3f0fe7d58c4cbfe8a8d0be0]
link Worker to Connected--><g id="link_Worker_Connected"><path codeLine="87" d="M979.33,588.22 C1003.88,600.56 1028.65,612.72 1052.5,624 C1108.17,650.33 1171.35,677.55 1222.8,699.05 " fill="none" id="Worker-to-Connected" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1227.42,700.98,1220.6398,693.8366,1222.8017,699.064,1217.5742,701.2259,1227.42,700.98" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="1156.5" y="667.0669">dispatch</text></g><!--MD5=[e6eda8209fcc069d88da9c43a94edcab]
link Worker to Disonnected--><g id="link_Worker_Disonnected"><path codeLine="93" d="M979,346.01 C1020.52,328.34 1064.77,314.12 1108.5,308 C1183.22,297.54 1213.46,284.11 1277.5,324 C1316.77,348.46 1344.56,394.24 1361.11,428.82 " fill="none" id="Worker-to-Disonnected" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1363.27,433.41,1363.0496,423.5636,1361.1376,428.8875,1355.8136,426.9755,1363.27,433.41" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="1109.5" y="290.0669">dispatch</text></g><!--MD5=[d618dc1135beff3a56053e06bc3550cf]
link Worker to Unstream--><g id="link_Worker_Unstream"><path codeLine="99" d="M979.02,474 C1008.72,474 1038.01,474 1064.23,474 " fill="none" id="Worker-to-Unstream" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1069.43,474,1060.43,470,1064.43,474,1060.43,478,1069.43,474" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="997.25" y="467.0669">dispatch</text></g><!--MD5=[99a81858ffbc401b83fff80fb9aa7fdb]
@startuml Worker

  object process.env {
    +MLN_KAFKA_HOSTS: localhost:9092,127.0.0.1:9092
    ....
    +MLN_KAFKA_CONNECTION_TIMEOUT: default 10000 ms
    +MLN_KAFKA_CONNECTION_IDLE: default 300000 ms
    ....
    +MLN_KAFKA_REQUEST_TIMEOUT: default 30000 ms
    +MLN_KAFKA_REQUEST_MAX_ASYNC: default 10
    ....
    +MLN_KAFKA_PRODUCER_HIGH_WATER_MARK: default 100
    +MLN_KAFKA_PRODUCER_ACK_TIMEOUT: default 100 ms
    ....
    +MLN_KAFKA_CONSUMER_HIGH_WATER_MARK: default 100
    +MLN_KAFKA_CONSUMER_FETCH_MAX_WAIT: default 100 ms
    +MLN_KAFKA_CONSUMER_FETCH_MIN_BYTES: default 1
    +MLN_KAFKA_CONSUMER_FETCH_MAX_BYTES: default 1024 * 1024
  }

  class Worker {
    -_client: kafka.KafkaClient
    -_producer: kafka.ProducerStream
    -_consumer: kafka.ConsumerStream
    -_resources: Map<resource, workers[]>
    -_workers: Map<worker, resources[]>
    -_connections: Map<worker, [out: Readable, in: Writable]>
    ....
    #getRate(resource: string): number
    ....
    +ping(): void
    +sync([worker, worker]): void
    +rate(resource: string): void
    ....
    +register(resource: string): void
    +unregister(resource: string): void
    ....
    +connect(worker: string): void
    +disconnect(worker: string): void
  }
  process.env - -> Worker: use to connect to the kafka

  class Ready {
    +type: "ready"
  }
  Ready <- Worker: dispatch

  class Sync {
    +type: "sync"
    +scope: workers
  }
  Sync <- Worker: .ping() -> dispatch\nwith workers

  class Updated {
    +type: "updated"
    +scope: [worker, resources]
  }
  Worker - -> Updated: dispatch

  class Removed {
    +type: "removed"
    +scope: [worker, resources]
  }
  Worker - -> Removed: dispatch

  class Rate {
    +type: "rate"
    +scope: [ worker, resource, number ]
  }
  Worker - -> Rate: dispatch

  class Connecting {
    +type: "connecting"
    +scope: worker
  }
  Worker - -> Connecting: dispatch

  class Stream {
    +type: "stream"
    +scope: [worker, worker]
  }
  Worker - -> Stream: dispatch

  class Connected {
    +type: "connected"
    +scope: [worker, [out, in]]
  }
  Worker - -> Connected: dispatch

  class Disonnected {
    +type: "disconnected"
    +scope: worker
  }
  Worker -> Disonnected: dispatch

  class Unstream {
    +type: "unstream"
    +scope: [worker, worker]
  }
  Worker -> Unstream: dispatch

@enduml

PlantUML version 1.2022.7(Mon Aug 22 10:01:30 PDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>