<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1101px" preserveAspectRatio="none" style="width:767px;height:1101px;background:#FFFFFF;" version="1.1" viewBox="0 0 767 1101" width="767px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="140.8281" style="stroke:#000000;stroke-width:1.5;" width="580" x="40" y="53.2969"/><rect fill="none" height="751.6641" style="stroke:#000000;stroke-width:1.5;" width="751" x="10" y="208.125"/><rect fill="none" height="353.2656" style="stroke:#000000;stroke-width:1.5;" width="600" x="20" y="232.2578"/><rect fill="none" height="263.8672" style="stroke:#000000;stroke-width:1.5;" width="474" x="30" y="314.6563"/><rect fill="none" height="232.7344" style="stroke:#000000;stroke-width:1.5;" width="454" x="40" y="338.7891"/><rect fill="none" height="353.2656" style="stroke:#000000;stroke-width:1.5;" width="731" x="20" y="599.5234"/><rect fill="none" height="263.8672" style="stroke:#000000;stroke-width:1.5;" width="474" x="30" y="681.9219"/><rect fill="none" height="232.7344" style="stroke:#000000;stroke-width:1.5;" width="454" x="40" y="706.0547"/><rect fill="none" height="75.3984" style="stroke:#000000;stroke-width:1.5;" width="454" x="40" y="973.7891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="80" x2="80" y1="36.2969" y2="1066.1875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="420" x2="420" y1="98.5781" y2="1066.1875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="552" x2="552" y1="36.2969" y2="1066.1875"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="680" x2="680" y1="36.2969" y2="1066.1875"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="50" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="57" y="24.9951">Broker</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="60" x="50" y="1065.1875"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="57" y="1085.1826">Broker</text><path d="M361,1065.1875 L479,1065.1875 C484,1065.1875 484,1078.3359 484,1078.3359 C484,1078.3359 484,1091.4844 479,1091.4844 L361,1091.4844 C356,1091.4844 356,1078.3359 356,1078.3359 C356,1078.3359 356,1065.1875 361,1065.1875 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M479,1065.1875 C474,1065.1875 474,1078.3359 474,1078.3359 C474,1091.4844 479,1091.4844 479,1091.4844 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="361" y="1083.1826">mln.io/node/uid</text><path d="M499,10 L605,10 C610,10 610,23.1484 610,23.1484 C610,23.1484 610,36.2969 605,36.2969 L499,36.2969 C494,36.2969 494,23.1484 494,23.1484 C494,23.1484 494,10 499,10 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M605,10 C600,10 600,23.1484 600,23.1484 C600,36.2969 605,36.2969 605,36.2969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="499" y="27.9951">mln.io/routers</text><path d="M499,1065.1875 L605,1065.1875 C610,1065.1875 610,1078.3359 610,1078.3359 C610,1078.3359 610,1091.4844 605,1091.4844 L499,1091.4844 C494,1091.4844 494,1078.3359 494,1078.3359 C494,1078.3359 494,1065.1875 499,1065.1875 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M605,1065.1875 C600,1065.1875 600,1078.3359 600,1078.3359 C600,1091.4844 605,1091.4844 605,1091.4844 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="499" y="1083.1826">mln.io/routers</text><path d="M625,10 L736,10 C741,10 741,23.1484 741,23.1484 C741,23.1484 741,36.2969 736,36.2969 L625,36.2969 C620,36.2969 620,23.1484 620,23.1484 C620,23.1484 620,10 625,10 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M736,10 C731,10 731,23.1484 731,23.1484 C731,36.2969 736,36.2969 736,36.2969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="625" y="27.9951">mln.io/workers</text><path d="M625,1065.1875 L736,1065.1875 C741,1065.1875 741,1078.3359 741,1078.3359 C741,1078.3359 741,1091.4844 736,1091.4844 L625,1091.4844 C620,1091.4844 620,1078.3359 620,1078.3359 C620,1078.3359 620,1065.1875 625,1065.1875 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M736,1065.1875 C731,1065.1875 731,1078.3359 731,1078.3359 C731,1091.4844 736,1091.4844 736,1091.4844 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="625" y="1083.1826">mln.io/workers</text><path d="M40,53.2969 L171,53.2969 L171,60.4297 L161,70.4297 L40,70.4297 L40,53.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="140.8281" style="stroke:#000000;stroke-width:1.5;" width="580" x="40" y="53.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="86" x="55" y="66.3638">registration</text><polygon fill="#181818" points="344,87.5625,354,91.5625,344,95.5625,348,91.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="350" y1="91.5625" y2="91.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="87" y="86.4966">create heartbeat queue</text><path d="M361,70.4297 L479,70.4297 C484,70.4297 484,83.5781 484,83.5781 C484,83.5781 484,96.7266 479,96.7266 L361,96.7266 C356,96.7266 356,83.5781 356,83.5781 C356,83.5781 356,70.4297 361,70.4297 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M479,70.4297 C474,70.4297 474,83.5781 474,83.5781 C474,96.7266 479,96.7266 479,96.7266 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="361" y="88.4248">mln.io/node/uid</text><polygon fill="#181818" points="91,123.8594,81,127.8594,91,131.8594,87,127.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85" x2="419" y1="127.8594" y2="127.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="97" y="122.7935">ack</text><polygon fill="#181818" points="540,152.9922,550,156.9922,540,160.9922,544,156.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="546" y1="156.9922" y2="156.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="87" y="151.9263">send registered message</text><polygon fill="#181818" points="91,182.125,81,186.125,91,190.125,87,186.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85" x2="551" y1="186.125" y2="186.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="97" y="181.0591">ack</text><path d="M10,208.125 L153,208.125 L153,215.2578 L143,225.2578 L10,225.2578 L10,208.125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="751.6641" style="stroke:#000000;stroke-width:1.5;" width="751" x="10" y="208.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="25" y="221.1919">orchestration</text><path d="M20,232.2578 L122,232.2578 L122,239.3906 L112,249.3906 L20,249.3906 L20,232.2578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="353.2656" style="stroke:#000000;stroke-width:1.5;" width="600" x="20" y="232.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="57" x="35" y="245.3247">brokers</text><polygon fill="#181818" points="540,266.5234,550,270.5234,540,274.5234,544,270.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="546" y1="270.5234" y2="270.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="87" y="265.4575">subscribe from the beginning</text><polygon fill="#181818" points="91,295.6563,81,299.6563,91,303.6563,87,299.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85" x2="551" y1="299.6563" y2="299.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="97" y="294.5903">messages</text><path d="M30,314.6563 L107,314.6563 L107,321.7891 L97,331.7891 L30,331.7891 L30,314.6563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="263.8672" style="stroke:#000000;stroke-width:1.5;" width="474" x="30" y="314.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="45" y="327.7231">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="124" x="122" y="326.8667">[for each message]</text><path d="M40,338.7891 L104,338.7891 L104,345.9219 L94,355.9219 L40,355.9219 L40,338.7891 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="232.7344" style="stroke:#000000;stroke-width:1.5;" width="454" x="40" y="338.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="55" y="351.856">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="76" x="119" y="350.9995">[registered]</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="122" y1="377.0547" y2="377.0547"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="122" x2="122" y1="377.0547" y2="390.0547"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81" x2="122" y1="390.0547" y2="390.0547"/><polygon fill="#181818" points="91,386.0547,81,390.0547,91,394.0547,87,390.0547" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="87" y="371.9888">add registered broker to the list</text><polygon fill="#181818" points="408,415.1875,418,419.1875,408,423.1875,412,419.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="414" y1="419.1875" y2="419.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="87" y="414.1216">subscribe for the registered heartbeat queue</text><polygon fill="#181818" points="91,444.3203,81,448.3203,91,452.3203,87,448.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85" x2="419" y1="448.3203" y2="448.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="97" y="443.2544">ack</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="40" x2="494" y1="457.3203" y2="457.3203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="45" y="467.5308">[removed]</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="122" y1="492.2578" y2="492.2578"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="122" x2="122" y1="492.2578" y2="505.2578"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81" x2="122" y1="505.2578" y2="505.2578"/><polygon fill="#181818" points="91,501.2578,81,505.2578,91,509.2578,87,505.2578" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="87" y="487.1919">remove broker from the list</text><polygon fill="#181818" points="408,530.3906,418,534.3906,408,538.3906,412,534.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="414" y1="534.3906" y2="534.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="87" y="529.3247">unsubscribe from the registered heartbeat queue</text><polygon fill="#181818" points="91,559.5234,81,563.5234,91,567.5234,87,563.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85" x2="419" y1="563.5234" y2="563.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="97" y="558.4575">ack</text><path d="M20,599.5234 L124,599.5234 L124,606.6563 L114,616.6563 L20,616.6563 L20,599.5234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="353.2656" style="stroke:#000000;stroke-width:1.5;" width="731" x="20" y="599.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="59" x="35" y="612.5903">workers</text><polygon fill="#181818" points="668.5,633.7891,678.5,637.7891,668.5,641.7891,672.5,637.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="674.5" y1="637.7891" y2="637.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="87" y="632.7231">subscribe from the beginning</text><polygon fill="#181818" points="91,662.9219,81,666.9219,91,670.9219,87,666.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85" x2="679.5" y1="666.9219" y2="666.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="97" y="661.856">messages</text><path d="M30,681.9219 L107,681.9219 L107,689.0547 L97,699.0547 L30,699.0547 L30,681.9219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="263.8672" style="stroke:#000000;stroke-width:1.5;" width="474" x="30" y="681.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="45" y="694.9888">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="124" x="122" y="694.1323">[for each message]</text><path d="M40,706.0547 L104,706.0547 L104,713.1875 L94,723.1875 L40,723.1875 L40,706.0547 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="232.7344" style="stroke:#000000;stroke-width:1.5;" width="454" x="40" y="706.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="55" y="719.1216">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="76" x="119" y="718.2651">[registered]</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="122" y1="744.3203" y2="744.3203"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="122" x2="122" y1="744.3203" y2="757.3203"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81" x2="122" y1="757.3203" y2="757.3203"/><polygon fill="#181818" points="91,753.3203,81,757.3203,91,761.3203,87,757.3203" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="87" y="739.2544">add registered worker to the list</text><polygon fill="#181818" points="408,782.4531,418,786.4531,408,790.4531,412,786.4531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="414" y1="786.4531" y2="786.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="87" y="781.3872">subscribe for the registered heartbeat queue</text><polygon fill="#181818" points="91,811.5859,81,815.5859,91,819.5859,87,815.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85" x2="419" y1="815.5859" y2="815.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="97" y="810.52">ack</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="40" x2="494" y1="824.5859" y2="824.5859"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="65" x="45" y="834.7964">[removed]</text><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="122" y1="859.5234" y2="859.5234"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="122" x2="122" y1="859.5234" y2="872.5234"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81" x2="122" y1="872.5234" y2="872.5234"/><polygon fill="#181818" points="91,868.5234,81,872.5234,91,876.5234,87,872.5234" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="87" y="854.4575">remove worker from the list</text><polygon fill="#181818" points="408,897.6563,418,901.6563,408,905.6563,412,901.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="414" y1="901.6563" y2="901.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="316" x="87" y="896.5903">unsubscribe from the registered heartbeat queue</text><polygon fill="#181818" points="91,926.7891,81,930.7891,91,934.7891,87,930.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85" x2="419" y1="930.7891" y2="930.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="97" y="925.7231">ack</text><path d="M40,973.7891 L181,973.7891 L181,980.9219 L171,990.9219 L40,990.9219 L40,973.7891 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.3984" style="stroke:#000000;stroke-width:1.5;" width="454" x="40" y="973.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="96" x="55" y="986.856">heartbeating</text><polygon fill="#181818" points="408,1008.0547,418,1012.0547,408,1016.0547,412,1012.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="80" x2="414" y1="1012.0547" y2="1012.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="87" y="1006.9888">heartbeat message</text><polygon fill="#181818" points="91,1037.1875,81,1041.1875,91,1045.1875,87,1041.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="85" x2="419" y1="1041.1875" y2="1041.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="97" y="1036.1216">ack</text><!--MD5=[57b4a288b4dd93c820e31fff37bb43c2]
@startuml broker_up

  participant Broker
  queue "mln.io/node/uid" as Heartbeat
  queue "mln.io/routers" as Brokers
  queue "mln.io/workers" as Workers

  group registration
    Broker - -> Heartbeat **: create heartbeat queue
    Broker <- - Heartbeat: ack
    Broker - -> Brokers: send registered message
    Broker <- - Brokers: ack
  end

  group orchestration
    group brokers
      Broker - -> Brokers: subscribe from the beginning
      Broker <- - Brokers: messages
      loop for each message
        alt registered
          Broker - -> Broker: add registered broker to the list
          Broker - -> Heartbeat: subscribe for the registered heartbeat queue
          Broker <- - Heartbeat: ack
        else removed
          Broker - -> Broker: remove broker from the list
          Broker - -> Heartbeat: unsubscribe from the registered heartbeat queue
          Broker <- - Heartbeat: ack
        end
      end
    end
    group workers
      Broker - -> Workers: subscribe from the beginning
      Broker <- - Workers: messages
      loop for each message
        alt registered
          Broker - -> Broker: add registered worker to the list
          Broker - -> Heartbeat: subscribe for the registered heartbeat queue
          Broker <- - Heartbeat: ack
        else removed
          Broker - -> Broker: remove worker from the list
          Broker - -> Heartbeat: unsubscribe from the registered heartbeat queue
          Broker <- - Heartbeat: ack
        end
      end
    end
  end

  group heartbeating
    Broker - -> Heartbeat: heartbeat message
    Broker <- - Heartbeat: ack
  end

@enduml

PlantUML version 1.2022.7(Mon Aug 22 10:01:30 PDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>